machine:
    services:
        - docker
    php:
        version: 5.4.37

dependencies:
    cache_directories:
        - "~/docker"
    override:
        - curl -sS https://getcomposer.org/installer | php
        - php composer.phar install --no-dev --prefer-source
        - docker run -d -p 7474:7474 tpires/neo4j; sleep 20
        - 'curl http://localhost:7474/user/neo4j/password -X POST -H "Content-Type: application/json" -H "Accept: application/json; charset=UTF-8" -H "Authorization: Basic bmVvNGo6bmVvNGo=" -d "{\"password\":\"ci\"}"'
        - pecl install xdebug
        - cat ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/xdebug.ini | sed -e "s/;//" > xdebug.ini
        - mv xdebug.ini ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/xdebug.ini

test:
    override:
        - phpunit --coverage-clover=coverage.clover
    post:
        - wget https://scrutinizer-ci.com/ocular.phar
        - php ocular.phar code-coverage:upload --format=php-clover coverage.clover
