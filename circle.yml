machine:
    services:
        - docker
    php:
        version: 5.4.37

dependencies:
    cache_directories:
        - "~/docker"
    pre:
        - sed -i 's/^;//' ~/.phpenv/versions/$(phpenv global)/etc/conf.d/xdebug.ini
    override:
        - curl -sS https://getcomposer.org/installer | php
        - php composer.phar install --no-dev --prefer-source
        - 'HASH=$(docker run -d -p 7474:7474 tpires/neo4j); RETURN=$(docker logs $HASH | grep "Remote interface ready"); while [ -n "$RETURN" ]; do sleep 1; RETURN=$(docker logs $HASH | grep "Remote interface ready"); done'
        - 'curl http://localhost:7474/user/neo4j/password -X POST -H "Content-Type: application/json" -H "Accept: application/json; charset=UTF-8" -H "Authorization: Basic bmVvNGo6bmVvNGo=" -d "{\"password\":\"ci\"}"'

test:
    override:
        - phpunit --coverage-clover=coverage.clover
    post:
        - wget https://scrutinizer-ci.com/ocular.phar
        - php ocular.phar code-coverage:upload --format=php-clover coverage.clover
